{"version":3,"sources":["../../server/controllers/Users.js"],"names":["loadUser","req","res","send","quickcredit","users","createUser","user","body","response","firstName","lastName","email","password","status","data","error","isEmailExist","message","id","length","token","createdOn","Date","isAdmin","push","json","login","credentials","undefined","userInfo","find","address","toggleVerification","userEmail","params","userIndex","findIndex","resetPassword","userParams","oldpassword","newpassword"],"mappings":";;;;;;;AACA;;AACA;;;;AAFA;AAIO,IAAMA,QAAQ,GAAG,SAAXA,QAAW,CAACC,GAAD,EAAMC,GAAN,EAAc;AACpCA,EAAAA,GAAG,CAACC,IAAJ,CAASC,qBAAYC,KAArB;AACD,CAFM;;;;AAIA,IAAMC,UAAU,GAAG,SAAbA,UAAa,CAACL,GAAD,EAAMC,GAAN,EAAc;AACtC,MAAMK,IAAI,GAAGN,GAAG,CAACO,IAAjB;AACA,MAAIC,QAAQ,GAAG,EAAf;;AACA,MAAI,CAACF,IAAI,CAACG,SAAN,IAAmB,CAACH,IAAI,CAACI,QAAzB,IAAqC,CAACJ,IAAI,CAACK,KAA3C,IAAoD,CAACL,IAAI,CAACM,QAA9D,EAAwE;AACtEJ,IAAAA,QAAQ,GAAG;AACTK,MAAAA,MAAM,EAAE,GADC;AAETC,MAAAA,IAAI,EAAE;AACJC,QAAAA,KAAK,EAAE;AADH;AAFG,KAAX;AAMD,GAPD,MAOO,IAAIC,yBAAJ,EAAkB;AACvBR,IAAAA,QAAQ,GAAG;AACTK,MAAAA,MAAM,EAAE,GADC;AAETC,MAAAA,IAAI,EAAE;AACJG,QAAAA,OAAO,EAAE;AADL;AAFG,KAAX;AAMD,GAPM,MAOA;AACL;AACAX,IAAAA,IAAI,CAACY,EAAL,GAAUf,qBAAYC,KAAZ,CAAkBe,MAAlB,GAA2B,CAArC;AACAb,IAAAA,IAAI,CAACc,KAAL,GAAa,iCAAb;AACAd,IAAAA,IAAI,CAACO,MAAL,GAAc,WAAd;AACAP,IAAAA,IAAI,CAACe,SAAL,GAAiB,IAAIC,IAAJ,EAAjB;AACAhB,IAAAA,IAAI,CAACiB,OAAL,GAAe,KAAf,CANK,CAOL;;AACApB,yBAAYC,KAAZ,CAAkBoB,IAAlB,CAAuBlB,IAAvB,EARK,CASL;;;AACAE,IAAAA,QAAQ,GAAG;AACTK,MAAAA,MAAM,EAAE,GADC;AAETC,MAAAA,IAAI,EAAE;AACJI,QAAAA,EAAE,EAAEZ,IAAI,CAACY,EADL;AAEJE,QAAAA,KAAK,EAAEd,IAAI,CAACc,KAFR;AAGJX,QAAAA,SAAS,EAAEH,IAAI,CAACG,SAHZ;AAIJC,QAAAA,QAAQ,EAAEJ,IAAI,CAACI,QAJX;AAKJC,QAAAA,KAAK,EAAEL,IAAI,CAACK,KALR;AAMJC,QAAAA,QAAQ,EAAEN,IAAI,CAACM,QANX;AAOJC,QAAAA,MAAM,EAAEP,IAAI,CAACO,MAPT;AAQJQ,QAAAA,SAAS,EAAEf,IAAI,CAACe;AARZ;AAFG,KAAX;AAaD;;AACDpB,EAAAA,GAAG,CAACY,MAAJ,CAAWL,QAAQ,CAACK,MAApB,EAA4BY,IAA5B,CAAiCjB,QAAjC;AACD,CA1CM;;;;AA4CA,IAAMkB,KAAK,GAAG,SAARA,KAAQ,CAAC1B,GAAD,EAAMC,GAAN,EAAc;AACjC,MAAIO,QAAQ,GAAG,EAAf;AACA,MAAMmB,WAAW,GAAG3B,GAAG,CAACO,IAAxB;;AACA,MAAIoB,WAAW,CAAChB,KAAZ,KAAsBiB,SAAtB,IAAmCD,WAAW,CAACf,QAAZ,KAAyBgB,SAAhE,EAA2E;AACzEpB,IAAAA,QAAQ,GAAG;AACTK,MAAAA,MAAM,EAAE,GADC;AAETC,MAAAA,IAAI,EAAE;AACJC,QAAAA,KAAK,EAAE;AADH;AAFG,KAAX;AAMD,GAPD,MAOO;AACL;AACA,QAAMc,QAAQ,GAAG1B,qBAAYC,KAAZ,CAAkB0B,IAAlB,CAAuB,UAAAxB,IAAI;AAAA,aAAIA,IAAI,CAACK,KAAL,KAAegB,WAAW,CAAChB,KAA3B,IAAoCL,IAAI,CAACM,QAAL,KAAkBe,WAAW,CAACf,QAAtE;AAAA,KAA3B,CAAjB;;AACA,QAAIiB,QAAQ,KAAKD,SAAjB,EAA4B;AAC1BpB,MAAAA,QAAQ,GAAG;AACTK,QAAAA,MAAM,EAAE,GADC;AAETC,QAAAA,IAAI,EAAE;AACJG,UAAAA,OAAO,EAAE;AADL;AAFG,OAAX;AAMD,KAPD,MAOO,IAAIY,QAAQ,CAAChB,MAAT,KAAoB,YAAxB,EAAsC;AAC3CL,MAAAA,QAAQ,GAAG;AACTK,QAAAA,MAAM,EAAE,GADC;AAETC,QAAAA,IAAI,EAAE;AACJG,UAAAA,OAAO,EAAE;AADL;AAFG,OAAX;AAMD,KAPM,MAOA;AACL;AACAT,MAAAA,QAAQ,GAAG;AACTK,QAAAA,MAAM,EAAE,GADC;AAETC,QAAAA,IAAI,EAAE;AACJI,UAAAA,EAAE,EAAEW,QAAQ,CAACX,EADT;AAEJE,UAAAA,KAAK,EAAES,QAAQ,CAACT,KAFZ;AAGJX,UAAAA,SAAS,EAAEoB,QAAQ,CAACpB,SAHhB;AAIJC,UAAAA,QAAQ,EAAEmB,QAAQ,CAACnB,QAJf;AAKJC,UAAAA,KAAK,EAAEkB,QAAQ,CAAClB,KALZ;AAMJoB,UAAAA,OAAO,EAAEF,QAAQ,CAACE,OANd;AAOJlB,UAAAA,MAAM,EAAEgB,QAAQ,CAAChB,MAPb;AAQJU,UAAAA,OAAO,EAAEM,QAAQ,CAACN,OARd;AASJF,UAAAA,SAAS,EAAEQ,QAAQ,CAACR;AAThB;AAFG,OAAX;AAcD;AACF;;AACDpB,EAAAA,GAAG,CAACY,MAAJ,CAAWL,QAAQ,CAACK,MAApB,EAA4BY,IAA5B,CAAiCjB,QAAjC;AACD,CA9CM;;;;AA+CA,IAAMwB,kBAAkB,GAAG,SAArBA,kBAAqB,CAAChC,GAAD,EAAMC,GAAN,EAAc;AAC9C;AACA,MAAIO,QAAQ,GAAG,EAAf;AACA,MAAMyB,SAAS,GAAGjC,GAAG,CAACkC,MAAJ,CAAWvB,KAA7B;AACA,MAAMkB,QAAQ,GAAG1B,qBAAYC,KAA7B;;AACA,MAAI,CAACJ,GAAG,CAACkC,MAAJ,CAAWvB,KAAZ,KAAsBiB,SAA1B,EAAqC;AACnCpB,IAAAA,QAAQ,GAAG;AACTK,MAAAA,MAAM,EAAE,GADC;AAETC,MAAAA,IAAI,EAAE;AACJG,QAAAA,OAAO,EAAE;AADL;AAFG,KAAX;AAMD,GAPD,MAOO;AACP;AACE,QAAMkB,SAAS,GAAGN,QAAQ,CAACO,SAAT,CAAmB,UAAA9B,IAAI;AAAA,aAAIA,IAAI,CAACK,KAAL,KAAesB,SAAnB;AAAA,KAAvB,CAAlB;;AACA,QAAIE,SAAS,KAAK,CAAC,CAAnB,EAAsB;AACpB3B,MAAAA,QAAQ,GAAG;AACTK,QAAAA,MAAM,EAAE,GADC;AAETC,QAAAA,IAAI,EAAE;AACJG,UAAAA,OAAO,+BAAwBgB,SAAxB;AADH;AAFG,OAAX;AAMD,KAPD,MAOO;AACP;AACEJ,MAAAA,QAAQ,CAACM,SAAD,CAAR,CAAoBtB,MAApB,GAA6B,UAA7B,CAFK,CAGL;;AACAL,MAAAA,QAAQ,GAAG;AACTK,QAAAA,MAAM,EAAE,GADC;AAETC,QAAAA,IAAI,EAAE;AACJI,UAAAA,EAAE,EAAEW,QAAQ,CAACM,SAAD,CAAR,CAAoBjB,EADpB;AAEJE,UAAAA,KAAK,EAAES,QAAQ,CAACM,SAAD,CAAR,CAAoBf,KAFvB;AAGJX,UAAAA,SAAS,EAAEoB,QAAQ,CAACM,SAAD,CAAR,CAAoB1B,SAH3B;AAIJC,UAAAA,QAAQ,EAAEmB,QAAQ,CAACM,SAAD,CAAR,CAAoBzB,QAJ1B;AAKJC,UAAAA,KAAK,EAAEkB,QAAQ,CAACM,SAAD,CAAR,CAAoBxB,KALvB;AAMJE,UAAAA,MAAM,EAAEgB,QAAQ,CAACM,SAAD,CAAR,CAAoBtB;AANxB;AAFG,OAAX;AAWD;AACF;;AACDZ,EAAAA,GAAG,CAACY,MAAJ,CAAWL,QAAQ,CAACK,MAApB,EAA4BY,IAA5B,CAAiCjB,QAAjC;AACD,CAxCM;;;;AAyCA,IAAM6B,aAAa,GAAG,SAAhBA,aAAgB,CAACrC,GAAD,EAAMC,GAAN,EAAc;AACzC;AACA,MAAIO,QAAQ,GAAG,EAAf;AACA,MAAM8B,UAAU,GAAGtC,GAAG,CAACO,IAAvB;AACA,MAAMsB,QAAQ,GAAG1B,qBAAYC,KAA7B;;AACA,MAAI,CAACkC,UAAU,CAACC,WAAZ,IAA2B,CAACD,UAAU,CAACE,WAAvC,IAAsD,CAACxC,GAAG,CAACkC,MAAJ,CAAWd,KAAtE,EAA6E;AAC3EZ,IAAAA,QAAQ,GAAG;AACTK,MAAAA,MAAM,EAAE,GADC;AAETC,MAAAA,IAAI,EAAE;AACJG,QAAAA,OAAO,EAAE;AADL;AAFG,KAAX;AAMD,GAPD,MAOO;AACP;AACE,QAAMkB,SAAS,GAAGN,QAAQ,CAACO,SAAT,CAAmB,UAAA9B,IAAI;AAAA,aAAKA,IAAI,CAACc,KAAL,KAAepB,GAAG,CAACkC,MAAJ,CAAWd,KAA1B,IAAmCd,IAAI,CAACM,QAAL,KAAkB0B,UAAU,CAACC,WAArE;AAAA,KAAvB,CAAlB;;AACA,QAAIJ,SAAS,KAAK,CAAC,CAAnB,EAAsB;AACpB3B,MAAAA,QAAQ,GAAG;AACTK,QAAAA,MAAM,EAAE,GADC;AAETC,QAAAA,IAAI,EAAE;AACJG,UAAAA,OAAO,EAAE;AADL;AAFG,OAAX;AAMD,KAPD,MAOO,IAAIY,QAAQ,CAACM,SAAD,CAAR,CAAoBtB,MAApB,KAA+B,YAAnC,EAAiD;AACtDL,MAAAA,QAAQ,GAAG;AACTK,QAAAA,MAAM,EAAE,GADC;AAETC,QAAAA,IAAI,EAAE;AACJG,UAAAA,OAAO,EAAE;AADL;AAFG,OAAX;AAMD,KAPM,MAOA;AACP;AACEY,MAAAA,QAAQ,CAACM,SAAD,CAAR,CAAoBvB,QAApB,GAA+B0B,UAAU,CAACE,WAA1C,CAFK,CAGL;;AACAhC,MAAAA,QAAQ,GAAG;AACTK,QAAAA,MAAM,EAAE,GADC;AAETC,QAAAA,IAAI,EAAEe,QAAQ,CAACM,SAAD;AAFL,OAAX;AAID;AACF;;AACDlC,EAAAA,GAAG,CAACY,MAAJ,CAAWL,QAAQ,CAACK,MAApB,EAA4BY,IAA5B,CAAiCjB,QAAjC;AACD,CAxCM;AAyCP","sourcesContent":["// import nodemailer from 'nodemailer';\r\nimport quickcredit from '../models/database';\r\nimport { isEmailExist, generateToken } from '../helpers/userAccount';\r\n\r\nexport const loadUser = (req, res) => {\r\n  res.send(quickcredit.users);\r\n};\r\n\r\nexport const createUser = (req, res) => {\r\n  const user = req.body;\r\n  let response = {};\r\n  if (!user.firstName || !user.lastName || !user.email || !user.password) {\r\n    response = {\r\n      status: 400,\r\n      data: {\r\n        error: 'Bad request,all information are required',\r\n      },\r\n    };\r\n  } else if (isEmailExist) {\r\n    response = {\r\n      status: 200,\r\n      data: {\r\n        message: 'email already exist to other account',\r\n      },\r\n    };\r\n  } else {\r\n    // increment user id for the next user\r\n    user.id = quickcredit.users.length + 1;\r\n    user.token = generateToken();\r\n    user.status = 'unverfied';\r\n    user.createdOn = new Date();\r\n    user.isAdmin = false;\r\n    // push or add user to an array of users\r\n    quickcredit.users.push(user);\r\n    // response generate\r\n    response = {\r\n      status: 200,\r\n      data: {\r\n        id: user.id,\r\n        token: user.token,\r\n        firstName: user.firstName,\r\n        lastName: user.lastName,\r\n        email: user.email,\r\n        password: user.password,\r\n        status: user.status,\r\n        createdOn: user.createdOn,\r\n      },\r\n    };\r\n  }\r\n  res.status(response.status).json(response);\r\n};\r\n\r\nexport const login = (req, res) => {\r\n  let response = {};\r\n  const credentials = req.body;\r\n  if (credentials.email === undefined || credentials.password === undefined) {\r\n    response = {\r\n      status: 400,\r\n      data: {\r\n        error: 'Bad request,might be some missing paramaters',\r\n      },\r\n    };\r\n  } else {\r\n    // find user with provided credentials and user is verfiied\r\n    const userInfo = quickcredit.users.find(user => user.email === credentials.email && user.password === credentials.password);\r\n    if (userInfo === undefined) {\r\n      response = {\r\n        status: 200,\r\n        data: {\r\n          message: 'No data found, wrong username or password',\r\n        },\r\n      };\r\n    } else if (userInfo.status === 'unverified') {\r\n      response = {\r\n        status: 200,\r\n        data: {\r\n          message: 'sorry your account not yet verified,wait for a moment...!',\r\n        },\r\n      };\r\n    } else {\r\n      // login response specifications\r\n      response = {\r\n        status: 200,\r\n        data: {\r\n          id: userInfo.id,\r\n          token: userInfo.token,\r\n          firstName: userInfo.firstName,\r\n          lastName: userInfo.lastName,\r\n          email: userInfo.email,\r\n          address: userInfo.address,\r\n          status: userInfo.status,\r\n          isAdmin: userInfo.isAdmin,\r\n          createdOn: userInfo.createdOn,\r\n        },\r\n      };\r\n    }\r\n  }\r\n  res.status(response.status).json(response);\r\n};\r\nexport const toggleVerification = (req, res) => {\r\n  // getting user information from email\r\n  let response = {};\r\n  const userEmail = req.params.email;\r\n  const userInfo = quickcredit.users;\r\n  if (!req.params.email === undefined) {\r\n    response = {\r\n      status: 400,\r\n      data: {\r\n        message: 'Bad request,user email must be defined',\r\n      },\r\n    };\r\n  } else {\r\n  // load userId using account number\r\n    const userIndex = userInfo.findIndex(user => user.email === userEmail);\r\n    if (userIndex === -1) {\r\n      response = {\r\n        status: 200,\r\n        data: {\r\n          message: `No data related to ${userEmail} found`,\r\n        },\r\n      };\r\n    } else {\r\n    // updating account based on account index\r\n      userInfo[userIndex].status = 'verified';\r\n      // response object\r\n      response = {\r\n        status: 200,\r\n        data: {\r\n          id: userInfo[userIndex].id,\r\n          token: userInfo[userIndex].token,\r\n          firstName: userInfo[userIndex].firstName,\r\n          lastName: userInfo[userIndex].lastName,\r\n          email: userInfo[userIndex].email,\r\n          status: userInfo[userIndex].status,\r\n        },\r\n      };\r\n    }\r\n  }\r\n  res.status(response.status).json(response);\r\n};\r\nexport const resetPassword = (req, res) => {\r\n  // getting user information from url\r\n  let response = {};\r\n  const userParams = req.body;\r\n  const userInfo = quickcredit.users;\r\n  if (!userParams.oldpassword || !userParams.newpassword || !req.params.token) {\r\n    response = {\r\n      status: 400,\r\n      data: {\r\n        message: 'Bad request, there might be some missing parameters',\r\n      },\r\n    };\r\n  } else {\r\n  // load userId using token and password\r\n    const userIndex = userInfo.findIndex(user => (user.token === req.params.token && user.password === userParams.oldpassword));\r\n    if (userIndex === -1) {\r\n      response = {\r\n        status: 200,\r\n        data: {\r\n          message: 'No data related to your token found',\r\n        },\r\n      };\r\n    } else if (userInfo[userIndex].status === 'unverified') {\r\n      response = {\r\n        status: 200,\r\n        data: {\r\n          message: 'sorry your account not yet verified, wait for a moment...!',\r\n        },\r\n      };\r\n    } else {\r\n    // updating account based on account index\r\n      userInfo[userIndex].password = userParams.newpassword;\r\n      // response object\r\n      response = {\r\n        status: 200,\r\n        data: userInfo[userIndex],\r\n      };\r\n    }\r\n  }\r\n  res.status(response.status).json(response);\r\n};\r\n/*\r\n    emailSend(req,res){\r\n        res.send(req.body);\r\n        let transporter = nodeMailer.createTransport({\r\n            host: 'smtp.gmail.com',\r\n            port: 465,\r\n            secure: true,\r\n            auth: {\r\n                user: 'hasua.mr@gmail.com',\r\n                pass: 'Roger2709'\r\n            }\r\n        });\r\n        let mailOptions = {\r\n            from: '\"Dj Bufu', // sender address\r\n            to: req.body.to, // list of receivers\r\n            subject: req.body.subject, // Subject line\r\n            text: req.body.body, // plain text body\r\n            html: '<b>NodeJS Email Tutorial</b>' // html body\r\n        }\r\n\r\n        transporter.sendMail(mailOptions, (error, info) => {\r\n            if (error) {\r\n                res.send(error);\r\n            }\r\n    res.send(\"Succesfull sent \"+error);\r\n        });\r\n    }\r\n    */\r\n"],"file":"Users.js"}